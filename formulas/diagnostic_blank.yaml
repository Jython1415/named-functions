name: DIAGNOSTIC_BLANK
version: 1.0.0

description: >
  Diagnostic formula to test the behavior differences between self-executing LAMBDA pattern
  (LAMBDA(input, IF(,,))(0)) and direct formula (IF(,,)) for parameterless functions.
  Returns a structured report showing behavior in various contexts.

  This is a temporary diagnostic formula for issue #81 investigation.

parameters:
  - name: test_pattern
    description: Which pattern to test - "lambda" for LAMBDA(input, IF(,,))(0), "direct" for IF(,,)
    example: '"lambda"'

formula: |
  LET(
    /* Generate the blank value based on pattern */
    blank_value, IF(test_pattern = "lambda", LAMBDA(input, IF(,,))(0), IF(,,)),

    /* Test 1: Basic ISBLANK check */
    test1_result, ISBLANK(blank_value),
    test1_label, "ISBLANK check",

    /* Test 2: Type check */
    test2_result, IFERROR(TYPE(blank_value), "ERROR"),
    test2_label, "TYPE check",

    /* Test 3: Equality with empty string */
    test3_result, blank_value = "",
    test3_label, "Equals empty string",

    /* Test 4: In IF true branch */
    test4_result, ISBLANK(IF(TRUE, blank_value, "fallback")),
    test4_label, "IF(TRUE, blank, fallback)",

    /* Test 5: In IF false branch */
    test5_result, ISBLANK(IF(FALSE, "fallback", blank_value)),
    test5_label, "IF(FALSE, fallback, blank)",

    /* Test 6: MAP context - does it create array of blanks? */
    test6_result, IFERROR(COUNTA(MAP({1;2;3}, LAMBDA(x, blank_value))), "ERROR"),
    test6_label, "MAP blank count",

    /* Test 7: FILTER context - can blanks be filtered? */
    test7_result, IFERROR(ROWS(FILTER({1;2;3}, MAP({1;2;3}, LAMBDA(x, blank_value)) <> blank_value)), "ERROR"),
    test7_label, "FILTER with blank criterion",

    /* Test 8: String concatenation */
    test8_result, "prefix" & blank_value & "suffix",
    test8_label, "String concatenation",

    /* Test 9: LEN check */
    test9_result, IFERROR(LEN(blank_value), "ERROR"),
    test9_label, "LEN check",

    /* Test 10: ARRAYFORMULA wrapping */
    test10_result, IFERROR(COUNTA(ARRAYFORMULA(blank_value)), "ERROR"),
    test10_label, "ARRAYFORMULA wrapping",

    /* Compile results into structured output */
    header, {"Test", "Pattern: " & test_pattern},
    results, {
      {test1_label, test1_result};
      {test2_label, test2_result};
      {test3_label, test3_result};
      {test4_label, test4_result};
      {test5_label, test5_result};
      {test6_label, test6_result};
      {test7_label, test7_result};
      {test8_label, test8_result};
      {test9_label, test9_result};
      {test10_label, test10_result}
    },

    /* Return combined header and results */
    {header; results}
  )
