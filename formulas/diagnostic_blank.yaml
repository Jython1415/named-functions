name: DIAGNOSTIC_BLANK
version: 2.0.0

description: >
  Diagnostic formula to test behavior differences between self-executing LAMBDA pattern
  (LAMBDA(input, IF(,,))(0)) and direct formula (IF(,,)) for parameterless functions.
  Tests both patterns simultaneously and displays side-by-side comparison.

  Call with no parameters: =DIAGNOSTIC_BLANK()

  This is a temporary diagnostic formula for issue #81 investigation.

parameters: []

formula: |
  LET(
    /* Generate both blank values */
    blank_lambda, LAMBDA(input, IF(,,))(0),
    blank_direct, IF(,,),

    /* Test 1: Basic ISBLANK check */
    test1_lambda, ISBLANK(blank_lambda),
    test1_direct, ISBLANK(blank_direct),
    test1_match, test1_lambda = test1_direct,

    /* Test 2: Type check */
    test2_lambda, IFERROR(TYPE(blank_lambda), "ERROR"),
    test2_direct, IFERROR(TYPE(blank_direct), "ERROR"),
    test2_match, test2_lambda = test2_direct,

    /* Test 3: Equality with empty string */
    test3_lambda, blank_lambda = "",
    test3_direct, blank_direct = "",
    test3_match, test3_lambda = test3_direct,

    /* Test 4: In IF true branch */
    test4_lambda, ISBLANK(IF(TRUE, blank_lambda, "fallback")),
    test4_direct, ISBLANK(IF(TRUE, blank_direct, "fallback")),
    test4_match, test4_lambda = test4_direct,

    /* Test 5: In IF false branch */
    test5_lambda, ISBLANK(IF(FALSE, "fallback", blank_lambda)),
    test5_direct, ISBLANK(IF(FALSE, "fallback", blank_direct)),
    test5_match, test5_lambda = test5_direct,

    /* Test 6: MAP context - count blanks in array */
    test6_lambda, IFERROR(COUNTA(MAP({1;2;3}, LAMBDA(x, blank_lambda))), "ERROR"),
    test6_direct, IFERROR(COUNTA(MAP({1;2;3}, LAMBDA(x, blank_direct))), "ERROR"),
    test6_match, test6_lambda = test6_direct,

    /* Test 7: String concatenation */
    test7_lambda, "prefix" & blank_lambda & "suffix",
    test7_direct, "prefix" & blank_direct & "suffix",
    test7_match, test7_lambda = test7_direct,

    /* Test 8: LEN check */
    test8_lambda, IFERROR(LEN(blank_lambda), "ERROR"),
    test8_direct, IFERROR(LEN(blank_direct), "ERROR"),
    test8_match, test8_lambda = test8_direct,

    /* Test 9: ARRAYFORMULA wrapping */
    test9_lambda, IFERROR(COUNTA(ARRAYFORMULA(blank_lambda)), "ERROR"),
    test9_direct, IFERROR(COUNTA(ARRAYFORMULA(blank_direct)), "ERROR"),
    test9_match, test9_lambda = test9_direct,

    /* Test 10: Equality comparison between the two */
    test10_result, blank_lambda = blank_direct,
    test10_match, TRUE,

    /* Compile results into structured output */
    header, {"Test", "LAMBDA Pattern", "Direct Pattern", "Match?"},
    results, {
      {"1. ISBLANK check", test1_lambda, test1_direct, test1_match};
      {"2. TYPE check", test2_lambda, test2_direct, test2_match};
      {"3. Equals empty string", test3_lambda, test3_direct, test3_match};
      {"4. IF(TRUE, blank, ...)", test4_lambda, test4_direct, test4_match};
      {"5. IF(FALSE, ..., blank)", test5_lambda, test5_direct, test5_match};
      {"6. MAP blank count", test6_lambda, test6_direct, test6_match};
      {"7. String concat", test7_lambda, test7_direct, test7_match};
      {"8. LEN check", test8_lambda, test8_direct, test8_match};
      {"9. ARRAYFORMULA count", test9_lambda, test9_direct, test9_match};
      {"10. Direct equality", test10_result, test10_result, test10_match}
    },

    /* Return combined header and results */
    {header; results}
  )
